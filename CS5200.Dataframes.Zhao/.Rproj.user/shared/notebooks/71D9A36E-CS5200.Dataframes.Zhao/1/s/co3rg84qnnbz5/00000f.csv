"0","result = tryCatch({"
"0","  query <- ""SELECT DiscPrice FROM invoices"""
"0","  dbExecute(dbcon, query)"
"0","}, error = function(e){"
"0","  # If DiscPrice column not exist, add it."
"0","  alter <- ""ALTER TABLE invoices"
"0","                  ADD COLUMN DiscPrice "
"0","                  NUMERIC(10, 2);"""
"0","  dbExecute(dbcon, alter)"
"0","}, finally = {"
"0","  # update values in DiscPrice"
"0","  update <- ""UPDATE invoices"
"0","                SET DiscPrice = "
"0","                CASE"
"0","                  WHEN InvoiceId IN"
"0","                    (SELECT InvoiceId AS invId "
"0","                      FROM invoice_items"
"0","                      GROUP BY invId HAVING SUM(quantity) > 10)"
"0","                    THEN total * 0.9"
"0","                  ELSE total"
"0","                END;"""
"0","  dbExecute(dbcon, update)"
"0","})"
